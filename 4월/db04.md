# db04

## 조인
### CROSS JOIN, 카테시안 곱
- a(2) * b(3)
- 5개의 컬럼
- 10개 데이터, 20개 데이터 => 200개 데이터
- 대용량의 데이터를 발생시킬 때 사용함
```sql
SELECT *
FROM tb_emp, TB_DEPT;
```

### INNER JOIN, 동등조인
- 공통의 데이터가 같은지를 물어봄
```sql
SELECT 
	E.emp_no,
	E.emp_nm,
	E.dept_cd,
	D.DEPT_CD, 
	D.dept_nm
FROM tb_emp E, TB_DEPT D
WHERE E.DEPT_CD = D.DEPT_CD ;
```
- 테이블 명을 붙이는 이유는 같은 데이터를 가지고 있는데 모호해서 뒤에 별명을 붙여줌
- PK, FK로 잡아줌

### M:N 관계일 때
- 1:M 
- M:1 로 할 수 있는 중간 테이블을 만들어줌
- 사원 PK emp_no
- 사원자격증 FK emp_no, certi_cd
- 자격증 certi_cd
- 다대다 관계일 때 일대다, 다대일로 만들 수 있는 중간 테이블을 만들어줘야함, 즉 3개 테이블을 만들어야함
- 상품과 주문의 테이블 구조가 있음
- 다대다 관게임 M:N
- 상품 (1:M) 주문 상세 (M:1) 주문
- 주문 상세 order_id, product_id
- 1번 주문에 1번 상품이 있다
- 2번 주문에 1번 상품이 있다...
- 조인이 3개면 조인 조건은 2개다
- 조인이 4개면 조인 조건은 3개다
- N개의 조인은 N-1 조인 조건임


### 오라클 조인의 문제점
- 조건이 3갠대 조인 조건은 1개임
- 조인 조건과 일반 필터링 조건을 WHERE 절에 써서 구분하기가 힘듦
- ANSI 표준 조인이 등장했음
### 표준 이너 조인
```sql
SELECT 
    A.emp_no, A.emp_nm, A.addr, A.dept_cd, B.dept_nm
FROM tb_emp A JOIN tb_dept B
ON A.dept_cd = B.dept_cd
WHERE A.addr LIKE '%용인%'   
    AND A.emp_nm LIKE '김%'
ORDER BY A.emp_no
;
```
- 조인 조건, 필터링 조건, 조인 테이블을 명확히 볼 수 있음
- 모든 데이터베이스 공통사항 ANSI 표준
- JOIN이라고 쓰면 INNER가 알아서 들어감

### SQL 순서
- SELECT [DISTINCT] { 열이름 .... } 
- FROM  테이블 또는 뷰 이름
- JOIN  테이블 또는 뷰 이름
- ON    조인 조건
- WHERE 조회 조건
- GROUP BY  열을 그룹화
- HAVING    그룹화 조건
- ORDER BY  정렬할 열 [ASC | DESC];

### ANSI CROSS JOIN
```sql
SELECT 
    *
FROM test_a A 
CROSS JOIN test_B b
;
```

### NATURAL JOIN
- CROSS JOIN은 테이블의 컬럼수의 합이 나오지만
- NATURAL JOIN은 테이블 컬럼이 같으면 중복으로 나오지 않음
- 즉 자연 조인을 할 때 동일한 PK, FK면 특정한 테이블로 조회하지 말자
```SQL
SELECT 
    A.emp_no, A.emp_nm, dept_cd, B.dept_nm
FROM tb_emp A
NATURAL JOIN tb_dept B;
```
- 1. NATURAL JOIN은 동일한 이름을 갖는 컬럼들에 대해 자동으로 조인조건을 생성하는 기법입니다.
- 2. 즉, 자동으로 2개 이상의 테이블에서 같은 이름을 가진 컬럼을 찾아 INNER조인을 수행합니다.
- 3. 이 때 조인되는 동일 이름의 컬럼은 데이터 타입이 같아야 하며, 
    ALIAS나 테이블명을 자동 조인 컬럼 앞에 표기하면 안됩니다.
- 4. SELECT * 문법을 사용하면, 공통 컬럼은 집합에서 한번만 표기됩니다.
- 5. 공통 컬럼이 n개 이상이면 조인 조건이 n개로 처리됩니다.

### 문제점
- 조인 컬럼이 2개일 경우 예상과 다른 결과가 나옴
- 함부로 쓰면 안됨
- 2개가 FK가 똑같을 경우 조인이 이상하게 됨

### USING절 JOIN
- PK, FK의 조건을 직접 선택해서 NATURAL JOIN을 할 수 있음
- 조인 컬럼에 대해 ALIAS를 부여하지 말기

### OUTER JOIN
```sql
SELECT 
    A.emp_no, A.emp_nm, A.dept_cd, B.dept_cd, B.dept_nm
FROM tb_emp A, tb_dept B
WHERE A.dept_cd = B.dept_cd (+)
ORDER BY A.emp_no
;
```
- 매칭이 되지 않으면 싹다 NULL로 나옴 
- A.dept_cd랑 B.dept_cd랑 결과가 다름
  

## MyBatis
- Repository엔 Mapper 인터페이스만 있음됀다
- XML을 만듦
- given, when, then 작성하기
- mybatis-config.xml에 설정잡아주기 camelCase
- 추천, 비추천, SQL과의 싸움, 수정기능
- , Header 메뉴 배치, 로그인, 회원가입, 회원제 게시판, 댓글

- 위버스 클론코딩